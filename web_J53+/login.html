<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>南港展覽館接駁專車系統-管理系統</title>
    <link rel="shortcut icon" href="./img/NECC_logo.png" type="image/x-icon">
    <link rel="stylesheet" href="./bootstrap/bootstrap.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="app">

        <header>
            <nav class="p-3 d-flex align-items-center bg-light">
                <img src="./img/NECC_logo.png" alt="" style="height: 4vh; margin: 2vh 2vw; transform: scale(2);">
                <h2 class="mx-3" style="font-weight: 600;">南港展覽館接駁專車系統</h2>
                <a href="./index.html" class="btn rootBtn mx-3">&#9673; 路網圖</a>
                <a href="./login.html" class="btn btn-info rootBtn disabled mx-3">&#9881; 管理系統</a>
                <button @click="logout" v-show="data.isLogin" class="btn dangerBtn"
                    style="display: none; position: absolute; right: 2em;">登出</button>
            </nav>
        </header>

        <main>

            <!-- login -->

            <div class="container" style="width: 50vw; margin-top: 15vh; display: none;" v-show="!data.isLogin">

                <div id="alertVeri" style="position: fixed; top: 1em; right: 1em; font-weight: 900;"></div>
                <div id="alertAccPw" style="position: fixed; top: 1em; left: 1em; font-weight: 900;"></div>

                <form action @submit.prevent="login" method="post" class="p-5 shadow" novalidate v-show="!data.isLogin"
                    style="display: none;">

                    <h1 class="text-center mt-4" style="font-weight: 900;">網站管理-登入</h1>

                    <div class="form-row mt-4">
                        <div class="col">
                            <input type="text" class="form-control" v-model="data.acc" placeholder="帳號" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide your account.</div>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" v-model="data.pw" placeholder="密碼" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide your password.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5 align-items-center">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="data.veri" placeholder="驗證碼" required>
                        </div>
                        <span id="captcha" class="col-2 text-center mx-auto">{{ data.captcha }}</span>
                        <button type="button" class="btn grayBtn col-3" @click="reGenerate()"
                            style="height: 5vh;">重新產生驗證碼</button>
                    </div>

                    <hr>

                    <div class="form-row mt-4">
                        <button type="reset" class="btn grayBtn col-10 mx-auto" style="height: 5vh;">重整表單</button>
                    </div>

                    <div class="form-row mt-4">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="login">登入</button>
                    </div>

                </form>

            </div>

            <div v-show="data.isLogin">

                <div class="container mt-5 text-center"
                    style="background-color: var(--light); padding: 2em; border-radius: 50px 50px 10px 10px; width: 30vw; box-shadow: inset 5px 5px 10px 5px rgba(0, 0, 0, .2), 2px 2px 10px 0 rgba(0, 0, 0, .3);">
                    <a class="btn btn-secondary grayBtn disabled mx-3" style="width: 200px;"
                        v-show="!data.isStationManage">接駁車管理</a>
                    <button class="btn grayBtn mx-3" style="width: 200px;" @click="chgStation"
                        v-show="!data.isStationManage">站點管理</button>
                    <button class="btn grayBtn mx-3" style="width: 200px;" @click="chgBus"
                        v-show="data.isStationManage">接駁車管理</button>
                    <a class="btn btn-secondary grayBtn disabled mx-3" style="width: 200px;"
                        v-show="data.isStationManage">站點管理</a>
                </div>

                <div id="manage" class="mx-auto shadow"
                    style="width: 70vw; height: 60vh; background-color: var(--light); margin-top: 3vh; padding: 2em 7em; border-radius: 10px; position: relative; overflow-y: auto; overflow-x: hidden;">

                    <div style="display: flex; transition: .5s ease-in-out;" :style="{ marginLeft: data.mlManage }">

                        <!-- bus manage -->

                        <div style="position: relative;">

                            <div style="display: flex; justify-content: center; align-items: center;">
                                <button class="btn rootBtn" style="visibility: hidden;">看尛</button>
                                <h2 class="m-2" style="font-weight: 900;">接駁車管理</h2>
                                <button class="btn-sm greenBtn" @click="addNewBus">新增</button>
                            </div>

                            <table
                                class="container table table-striped table-light table-bordered table-hover shadow mt-4"
                                style="font-weight: 700; overflow: hidden; width: calc(70vw - 14em);">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>車牌</th>
                                        <th>已行駛時間</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in data.busData"
                                        :class="{ 'table-danger': item.chDel, 'confdelAnimation': item.confdelAnimation }">
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.time }}分鐘</td>
                                        <td style="width: 20em;" class="text-center">
                                            <button class="btn grayBtn mx-1" style="width: 8em; display: none;"
                                                @click="editBusRecord(item)" v-show="!item.chDel">編輯</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="delBusRecord(item.id)" v-show="!item.chDel">刪除</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="confBusDel(item.id)" v-show="item.chDel">確定刪除</button>
                                            <button class="btn greenBtn mx-1" style="width: 8em; display: none;"
                                                @click="unBusDel(item.id)" v-show="item.chDel">取消刪除</button>
                                        </td>
                                    </tr>
                                </tbody>
                                <div style="position: absolute; left: -5em;" v-show="data.busData.length > 5">
                                    <div class="hint">
                                        <p>Scroll&#8659;</p>
                                    </div>
                                </div>
                            </table>

                        </div>

                        <!-- station manage -->

                        <div style="position: relative; margin-left: 14em; margin-right: 14em;">

                            <div style="display: flex; justify-content: center; align-items: center;">
                                <button class="btn rootBtn" style="visibility: hidden;">看尛</button>
                                <h2 class="m-2" style="font-weight: 900;">站點管理</h2>
                                <button class="btn-sm greenBtn" @click="addNewStation">新增</button>
                            </div>

                            <table
                                class="container table table-striped table-light table-bordered table-hover shadow mt-4"
                                style="font-weight: 700; overflow: hidden; width: calc(70vw - 14em);">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>站點名稱</th>
                                        <th>行駛時間(分鐘)</th>
                                        <th>停留時間(分鐘)</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in data.stationData"
                                        :class="{ 'table-danger': item.chDel, 'confdelAnimation': item.confdelAnimation }">
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.time }}分鐘</td>
                                        <td>{{ item.wait }}分鐘</td>
                                        <td style="width: 20em;" class="text-center">
                                            <button class="btn grayBtn mx-1" style="width: 8em; display: none;"
                                                @click="editStationRecord(item)" v-show="!item.chDel">編輯</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="delStationRecord(item.id)" v-show="!item.chDel">刪除</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="confStationDel(item.id)" v-show="item.chDel">確定刪除</button>
                                            <button class="btn greenBtn mx-1" style="width: 8em; display: none;"
                                                @click="unStationDel(item.id)" v-show="item.chDel">取消刪除</button>
                                        </td>
                                    </tr>
                                </tbody>
                                <div style="position: absolute; right: -5em;" v-show="data.stationData.length > 5">
                                    <div class="hint">
                                        <p>Scroll&#8659;</p>
                                    </div>
                                </div>
                            </table>

                        </div>


                    </div>

                </div>

            </div>

            <!-- edit bus -->

            <div id="editBusForm" :class="data.isEditBus ? 'confEdit' : 'unEdit'">

                <form active="#" @submit.prevent="editBusSubmit(data.editBusId)" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">修改「{{ data.editBusName }}」</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="editBusTime">已行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editBusTime"
                                v-model="data.editBusTime" placeholder="請輸入已行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editBusSubmit(data.editBusId)">修改</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editBusPrev">回上頁</button>
                    </div>

                </form>

            </div>

            <!-- add new bus -->

            <div id="addNewBusForm" :class="data.isAddNewBus ? 'confAddNew' : 'unAddNew'">

                <form active="#" @submit.prevent="addNewBusSubmit" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">新增接駁車</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="addNewBusName">車牌</label>
                            <input type="text" class="form-control" id="addNewBusName" v-model="data.addNewBus.name"
                                placeholder="請輸入車牌" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide license Plate.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewBusTime">已行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewBusTime"
                                v-model="data.addNewBus.time" placeholder="請輸入已行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewBusSubmit">新增</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewBusPrev">回上頁</button>
                    </div>

                </form>

            </div>

            <!-- add new station -->

            <div id="addNewStationForm" :class="data.isAddNewStation ? 'confAddNew' : 'unAddNew'">

                <form active="#" @submit.prevent="addNewStationSubmit" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">新增接駁車</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="addNewStationName">站點名稱</label>
                            <input type="text" class="form-control" id="addNewStationName"
                                v-model="data.addNewStation.name" placeholder="請輸入站點名稱" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide station name.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewStationTime">行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewStationTime"
                                v-model="data.addNewStation.time" placeholder="請輸入行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewStationWait">停留時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewStationWait"
                                v-model="data.addNewStation.wait" placeholder="請輸入停留時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide residence time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewStationSubmit">新增</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewStationPrev">回上頁</button>
                    </div>

                </form>

            </div>

            <!-- edit station -->

            <div id="editStationForm" :class="data.isEditStation ? 'confEdit' : 'unEdit'">

                <form active="#" @submit.prevent="editStationSubmit(data.editBusId)" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">修改「{{ data.editStationName }}」</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="editStationTime">行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editStationTime"
                                v-model="data.editStationTime" placeholder="請輸入行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="col">
                            <label for="editStationWait">停留時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editStationWait"
                                v-model="data.editStationWait" placeholder="請輸入停留時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide residence time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editStationSubmit(data.editStationId)">修改</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editStationPrev">回上頁</button>
                    </div>

                </form>

            </div>

        </main>

    </div>

    <script src="./jquery/jquery.js"></script>
    <script src="./jquery/vue-3.2.31.global.js"></script>
    <script src="./bootstrap/bootstrap.js"></script>
    <script>

        const { reactive, onMounted } = Vue
        Vue.createApp({

            setup() {

                let data = reactive({
                    canFlod: true,
                    busData: [],
                    stationData: [],
                    addNewBus: [],
                    editBus: [],
                    addNewStation: []
                })

                let busData = undefined

                const reGenerate = () => {
                    data.captcha = Math.floor(Math.random() * 8999 + 1000)
                }

                const login = () => {
                    if (data.veri == data.captcha) {
                        $.get("./api/get.php", { mode: "getLoginData", acc: data.acc, pw: data.pw }, (r) => {
                            if (parseInt(r) == 1) {
                                localStorage.setItem("isLogin", "true")
                                data.isLogin = true
                                data.acc = ""
                                data.pw = ""
                                data.veri = ""
                            } else {
                                $("#alertAccPw").append('<div class="alert alert-warning alert-dismissible border border-warning fade show text-center text-danger" style="width: 15vw;">' +
                                    '<span>帳號或密碼錯誤，哈哈可憐</span>' +
                                    '<button type="button" class="close" data-dismiss="alert">' +
                                    '<span>&times;</span>' +
                                    '</button>' +
                                    '</div>')

                                $("input[name='acc'], input[name='pw']").addClass("border border-warning")

                                $("form").addClass("shake")

                                setTimeout(() => {
                                    $("form").removeClass("shake")
                                }, 300)
                            }
                        })
                    } else {
                        $("#alertVeri").append('<div class="alert alert-danger alert-dismissible border border-danger fade show text-center text-danger" style="width: 15vw;">' +
                            '<span>驗證碼錯誤，哈哈笑死</span>' +
                            '<button type="button" class="close" data-dismiss="alert">' +
                            '<span>&times;</span>' +
                            '</button>' +
                            '</div>')

                        $("input[name='veri']").addClass("border border-danger")

                        $("form").addClass("shake")

                        setTimeout(() => {
                            $("form").removeClass("shake")
                        }, 300)
                    }
                }

                const logout = () => {
                    data.isLogin = false
                    localStorage.setItem("isLogin", "false")
                }

                const getBusData = () => {
                    $.getJSON("./api/get.php", { mode: "getBusData" }, (r) => {
                        data.busData = r
                    })
                }

                const delBusRecord = (id) => {
                    data.busData.find((item) => item.id == id).chDel = true
                }

                const unBusDel = (id) => {
                    data.busData.find((item) => item.id == id).chDel = false
                }

                const confBusDel = (id) => {
                    $.post("./api/post.php", { mode: "delBus", id }, () => {
                        data.busData.find((item) => item.id == id).confdelAnimation = true
                        setTimeout(() => {
                            getBusData()
                        }, 200)
                    })
                }

                const editBusRecord = (item) => {
                    data.isEditBus = true
                    data.editBusId = item.id
                    data.editBusName = item.name
                    data.editBusTime = item.time
                }

                const editBusSubmit = (id) => {
                    if ($("#editBusForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "editBusData", id: data.editBusId, time: data.editBusTime }, () => {
                            data.isEditBus = false
                            $("#editBusForm>form").removeClass("was-validated")
                            getBusData()
                        })
                    } else {
                        $("#editBusForm>form").addClass("was-validated")
                    }
                }

                const editBusPrev = (id) => {
                    data.isEditBus = false
                    $("#editBusForm>form").removeClass("was-validated")
                }

                const addNewBus = () => {
                    data.isAddNewBus = true
                }

                const addNewBusSubmit = () => {
                    if ($("#addNewBusForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "addNewBus", name: data.addNewBus.name, time: data.addNewBus.time }, () => {
                            data.isAddNewBus = false
                            $("#addNewBusForm>form").removeClass("was-validated")
                            data.addNewBus = []
                            getBusData()
                        })
                    } else {
                        $("#addNewBusForm>form").addClass("was-validated")
                    }
                }

                const addNewBusPrev = () => {
                    data.isAddNewBus = false
                    $("#addNewBusForm>form").removeClass("was-validated")
                }

                const chgStation = () => {
                    data.flodDone = true
                    if (data.canFlod) {
                        data.canFlod = false
                        data.isStationManage = true
                        $("#manage").animate({ scrollTop: 0 }, "fast")
                        if ($("#manage").scrollTop() == 0) {
                            data.mlManage = "-70vw"
                        }
                        setTimeout(() => {
                            data.mlManage = "-70vw"
                        }, 200)
                        setTimeout(() => {
                            data.canFlod = true
                        }, 500)
                    }
                }

                const chgBus = () => {
                    if (data.canFlod) {
                        data.canFlod = false
                        data.isStationManage = false
                        $("#manage").animate({ scrollTop: 0 }, "fast")
                        if ($("#manage").scrollTop() == 0) {
                            data.mlManage = 0
                        }
                        setTimeout(() => {
                            data.mlManage = 0
                        }, 200)
                        setTimeout(() => {
                            data.canFlod = true
                        }, 500)
                    }
                }

                const getStationData = () => {
                    $.getJSON("./api/get.php", { mode: "getStationData" }, (r) => {
                        data.stationData = r
                    })
                }

                const addNewStation = () => {
                    data.isAddNewStation = true
                }

                const addNewStationSubmit = () => {
                    if ($("#addNewStationForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "addNewStation", name: data.addNewStation.name, time: data.addNewStation.time, wait: data.addNewStation.wait }, () => {
                            data.isAddNewStation = false
                            $("#addNewStationForm>form").removeClass("was-validated")
                            data.addNewStation = []
                            getStationData()
                        })
                    } else {
                        $("#addNewStationForm>form").addClass("was-validated")
                    }
                }

                const addNewStationPrev = () => {
                    data.isAddNewStation = false
                    $("#addNewStationForm>form").removeClass("was-validated")
                }

                const editStationRecord = (item) => {
                    data.isEditStation = true
                    data.editStationId = item.id
                    data.editStationName = item.name
                    data.editStationTime = item.time
                    data.editStationWait = item.wait
                }

                const delStationRecord = (id) => {
                    data.stationData.find((item) => item.id == id).chDel = true
                }

                const confStationDel = (id) => {
                    $.post("./api/post.php", { mode: "delStation", id }, () => {
                        data.stationData.find((item) => item.id == id).confdelAnimation = true
                        setTimeout(() => {
                            getStationData()
                        }, 200)
                    })
                }

                const unStationDel = (id) => {
                    data.stationData.find((item) => item.id == id).chDel = false
                }

                const editStationSubmit = () => {
                    if ($("#editStationForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "editStationData", id: data.editStationId, time: data.editStationTime, wait: data.editStationWait }, () => {
                            data.isEditStation = false
                            $("#editStationForm>form").removeClass("was-validated")
                            getStationData()
                        })
                    } else {
                        $("#editBusForm>form").addClass("was-validated")
                    }
                }

                const editStationPrev = () => {
                    data.isEditStation = false
                    $("#editStationForm>form").removeClass("was-validated")
                }

                onMounted(() => {
                    data.isLogin = localStorage.getItem("isLogin") == "true"
                    reGenerate()
                    getBusData()
                    getStationData()
                })

                return {
                    data,
                    reGenerate,
                    login,
                    logout,
                    addNewBus,
                    getBusData,
                    delBusRecord,
                    unBusDel,
                    confBusDel,
                    editBusRecord,
                    editBusSubmit,
                    editBusPrev,
                    addNewBusSubmit,
                    addNewBusPrev,
                    chgStation,
                    chgBus,
                    getStationData,
                    addNewStation,
                    addNewStationSubmit,
                    addNewStationPrev,
                    editStationRecord,
                    delStationRecord,
                    confStationDel,
                    unStationDel,
                    editStationSubmit,
                    editStationPrev
                }

            }

        }).mount("#app")

    </script>

</body>

</html>


<!-- BETA 2 for folding -->


<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>南港展覽館接駁專車系統-管理系統</title>
    <link rel="shortcut icon" href="./img/NECC_logo.png" type="image/x-icon">
    <link rel="stylesheet" href="./bootstrap/bootstrap.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="app">

        <header>
            <nav class="p-3 d-flex align-items-center bg-light">
                <img src="./img/NECC_logo.png" alt="" style="height: 4vh; margin: 2vh 2vw; transform: scale(2);">
                <h2 class="mx-3" style="font-weight: 600;">南港展覽館接駁專車系統</h2>
                <a href="./index.html" class="btn rootBtn mx-3">&#9673; 路網圖</a>
                <a href="./login.html" class="btn btn-info rootBtn disabled mx-3">&#9881; 管理系統</a>
                <button @click="logout" v-show="data.isLogin" class="btn dangerBtn"
                    style="display: none; position: absolute; right: 2em;">登出</button>
            </nav>
        </header>

        <main>

<div class="container" style="width: 50vw; margin-top: 15vh; display: none;" v-show="!data.isLogin">

                <div id="alertVeri" style="position: fixed; top: 1em; right: 1em; font-weight: 900;"></div>
                <div id="alertAccPw" style="position: fixed; top: 1em; left: 1em; font-weight: 900;"></div>

                <form action @submit.prevent="login" method="post" class="p-5 shadow" novalidate v-show="!data.isLogin"
                    style="display: none;">

                    <h1 class="text-center mt-4" style="font-weight: 900;">網站管理-登入</h1>

                    <div class="form-row mt-4">
                        <div class="col">
                            <input type="text" class="form-control" v-model="data.acc" placeholder="帳號" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide your account.</div>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control" v-model="data.pw" placeholder="密碼" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide your password.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5 align-items-center">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="data.veri" placeholder="驗證碼" required>
                        </div>
                        <span id="captcha" class="col-2 text-center mx-auto">{{ data.captcha }}</span>
                        <button type="button" class="btn grayBtn col-3" @click="reGenerate()"
                            style="height: 5vh;">重新產生驗證碼</button>
                    </div>

                    <hr>

                    <div class="form-row mt-4">
                        <button type="reset" class="btn grayBtn col-10 mx-auto" style="height: 5vh;">重整表單</button>
                    </div>

                    <div class="form-row mt-4">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="login">登入</button>
                    </div>

                </form>

            </div>

<div style="display: none;" v-show="data.isLogin">

                <div class="container mt-5 text-center"
                    style="background-color: var(--light); padding: 2em; border-radius: 50px 50px 10px 10px; width: 30vw; box-shadow: inset 5px 5px 10px 5px rgba(0, 0, 0, .2), 2px 2px 10px 0 rgba(0, 0, 0, .3);">
                    <a class="btn btn-secondary grayBtn disabled mx-3" style="width: 200px;"
                        v-show="!data.isStationManage">接駁車管理</a>
                    <button class="btn grayBtn mx-3" style="width: 200px;" @click="chgStation"
                        v-show="!data.isStationManage">站點管理</button>
                    <button class="btn grayBtn mx-3" style="width: 200px;" @click="chgBus"
                        v-show="data.isStationManage">接駁車管理</button>
                    <a class="btn btn-secondary grayBtn disabled mx-3" style="width: 200px;"
                        v-show="data.isStationManage">站點管理</a>
                </div>

                <div id="busManage" class="mx-auto shadow"
                    style="width: 70vw; height: 60vh; background-color: var(--light); margin-top: 3vh; padding: 2em 7em; border-radius: 10px; position: relative;"
                    :style="{ 'overflow-y': !data.isStationManage ? 'auto' : 'hidden'}">

                    <div style="display: flex; justify-content: center;">
                        <button class="btn rootBtn" style="visibility: hidden;">看尛</button>
                        <h2 class="m-2" style="font-weight: 900;">接駁車管理</h2>
                        <button class="btn greenBtn" @click="addNewBus">新增</button>
                    </div>

                    <table class="container table table-striped table-light table-bordered table-hover shadow mt-4"
                        style="font-weight: 700; overflow: hidden;">
                        <thead class="thead-dark">
                            <tr>
                                <th>車牌</th>
                                <th>已行駛時間</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in data.busData"
                                :class="{ 'table-danger': item.chDel, 'confdelAnimation': item.confdelAnimation }">
                                <td>{{ item.name }}</td>
                                <td>{{ item.time }}分鐘</td>
                                <td style="width: 20em;" class="text-center">
                                    <button class="btn grayBtn mx-1" style="width: 8em; display: none;"
                                        @click="editBusRecord(item)" v-show="!item.chDel">編輯</button>
                                    <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                        @click="delBusRecord(item.id)" v-show="!item.chDel">刪除</button>
                                    <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                        @click="confBusDel(item.id)" v-show="item.chDel">確定刪除</button>
                                    <button class="btn greenBtn mx-1" style="width: 8em; display: none;"
                                        @click="unBusDel(item.id)" v-show="item.chDel">取消刪除</button>
                                </td>
                            </tr>
                        </tbody>
                        <div style="position: absolute; right: 2em;" v-show="data.busData.length > 5">
                            <div class="hint">
                                <p>Scroll&#8659;</p>
                            </div>
                        </div>
                    </table>

<div class="mask" style="display: none;" v-show="data.isStationManage"></div>
                    <div id="stationManage" style="display: none; overflow-y: auto;"
                        :class="{ 'unfolding': data.isStationManage, 'refolding': !data.isStationManage && data.flodDone, 'unfold': data.isStationManage, 'refold': !data.isStationManage }">
                        <div>

                            <div style="display: flex; justify-content: center; margin-top: 40px;">
                                <button class="btn rootBtn" style="visibility: hidden;">看尛</button>
                                <h2 class="m-2" style="font-weight: 900;">站點管理</h2>
                                <button class="btn greenBtn" @click="addNewStation">新增</button>
                            </div>

                            <table
                                class="container table table-striped table-light table-bordered table-hover shadow mt-4"
                                style="font-weight: 700; overflow: hidden; width: calc(70vw - 14em);">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>站點名稱</th>
                                        <th>行駛時間(分鐘)</th>
                                        <th>停留時間(分鐘)</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in data.stationData"
                                        :class="{ 'table-danger': item.chDel, 'confdelAnimation': item.confdelAnimation }">
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.time }}分鐘</td>
                                        <td>{{ item.wait }}分鐘</td>
                                        <td style="width: 20em;" class="text-center">
                                            <button class="btn grayBtn mx-1" style="width: 8em; display: none;"
                                                @click="editStationRecord(item)" v-show="!item.chDel">編輯</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="delStationRecord(item.id)" v-show="!item.chDel">刪除</button>
                                            <button class="btn dangerBtn mx-1" style="width: 8em; display: none;"
                                                @click="confStationDel(item.id)" v-show="item.chDel">確定刪除</button>
                                            <button class="btn greenBtn mx-1" style="width: 8em; display: none;"
                                                @click="unStationDel(item.id)" v-show="item.chDel">取消刪除</button>
                                        </td>
                                    </tr>
                                </tbody>
                                <div style="position: absolute; right: 27px;" v-show="data.stationData.length > 5">
                                    <div class="hint">
                                        <p>Scroll&#8659;</p>
                                    </div>
                                </div>
                            </table>

                        </div>
                    </div>

                </div>

            </div>

<div id="editBusForm" :class="data.isEditBus ? 'confEdit' : 'unEdit'">

                <form active="#" @submit.prevent="editBusSubmit(data.editBusId)" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">修改「{{ data.editBusName }}」</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="editBusTime">已行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editBusTime"
                                v-model="data.editBusTime" placeholder="請輸入已行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editBusSubmit(data.editBusId)">修改</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editBusPrev">回上頁</button>
                    </div>

                </form>

            </div>

<div id="addNewBusForm" :class="data.isAddNewBus ? 'confAddNew' : 'unAddNew'">

                <form active="#" @submit.prevent="addNewBusSubmit" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">新增接駁車</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="addNewBusName">車牌</label>
                            <input type="text" class="form-control" id="addNewBusName" v-model="data.addNewBus.name"
                                placeholder="請輸入車牌" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide license Plate.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewBusTime">已行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewBusTime"
                                v-model="data.addNewBus.time" placeholder="請輸入已行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewBusSubmit">新增</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewBusPrev">回上頁</button>
                    </div>

                </form>

            </div>

<div id="addNewStationForm" :class="data.isAddNewStation ? 'confAddNew' : 'unAddNew'">

                <form active="#" @submit.prevent="addNewStationSubmit" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">新增接駁車</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="addNewStationName">站點名稱</label>
                            <input type="text" class="form-control" id="addNewStationName"
                                v-model="data.addNewStation.name" placeholder="請輸入站點名稱" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide station name.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewStationTime">行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewStationTime"
                                v-model="data.addNewStation.time" placeholder="請輸入行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <div class="col">
                            <label for="addNewStationWait">停留時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="addNewStationWait"
                                v-model="data.addNewStation.wait" placeholder="請輸入停留時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide residence time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewStationSubmit">新增</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="addNewStationPrev">回上頁</button>
                    </div>

                </form>

            </div>

<div id="editStationForm" :class="data.isEditStation ? 'confEdit' : 'unEdit'">

                <form active="#" @submit.prevent="editStationSubmit(data.editBusId)" method="post" class="p-5 shadow"
                    style="width: 40vw; background-color: rgba(255, 255, 255, .5);">

                    <h1 class="text-center" style="font-weight: 900;">修改「{{ data.editStationName }}」</h1>

                    <div class="form-row">
                        <div class="col">
                            <label for="editStationTime">行駛時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editStationTime"
                                v-model="data.editStationTime" placeholder="請輸入行駛時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide elapsed driving time.</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="col">
                            <label for="editStationWait">停留時間(分鐘)</label>
                            <input type="number" min="0" class="form-control" id="editStationWait"
                                v-model="data.editStationWait" placeholder="請輸入停留時間(分鐘)" required>
                            <div class="invalid-tooltip" style="opacity: .5;">Please provide residence time.</div>
                        </div>
                    </div>

                    <div class="form-row mt-5">
                        <button type="button" class="btn greenBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editStationSubmit(data.editStationId)">修改</button>
                    </div>

                    <div class="form-row mt-3">
                        <button type="button" class="btn grayBtn col-10 mx-auto" style="height: 5vh;"
                            @click="editStationPrev">回上頁</button>
                    </div>

                </form>

            </div>

        </main>

    </div>

    <script src="./jquery/jquery.js"></script>
    <script src="./jquery/vue-3.2.31.global.js"></script>
    <script src="./bootstrap/bootstrap.js"></script>
    <script>

        const { reactive, onMounted } = Vue
        Vue.createApp({

            setup() {

                let data = reactive({
                    canFlod: true,
                    busData: [],
                    stationData: [],
                    addNewBus: [],
                    editBus: [],
                    addNewStation: []
                })

                let busData = undefined

                const reGenerate = () => {
                    data.captcha = Math.floor(Math.random() * 8999 + 1000)
                }

                const login = () => {
                    if (data.veri == data.captcha) {
                        $.get("./api/get.php", { mode: "getLoginData", acc: data.acc, pw: data.pw }, (r) => {
                            if (parseInt(r) == 1) {
                                localStorage.setItem("isLogin", "true")
                                data.isLogin = true
                                data.acc = ""
                                data.pw = ""
                                data.veri = ""
                            } else {
                                $("#alertAccPw").append('<div class="alert alert-warning alert-dismissible border border-warning fade show text-center text-danger" style="width: 15vw;">' +
                                    '<span>帳號或密碼錯誤，哈哈可憐</span>' +
                                    '<button type="button" class="close" data-dismiss="alert">' +
                                    '<span>&times;</span>' +
                                    '</button>' +
                                    '</div>')

                                $("input[name='acc'], input[name='pw']").addClass("border border-warning")

                                $("form").addClass("shake")

                                setTimeout(() => {
                                    $("form").removeClass("shake")
                                }, 300)
                            }
                        })
                    } else {
                        $("#alertVeri").append('<div class="alert alert-danger alert-dismissible border border-danger fade show text-center text-danger" style="width: 15vw;">' +
                            '<span>驗證碼錯誤，哈哈笑死</span>' +
                            '<button type="button" class="close" data-dismiss="alert">' +
                            '<span>&times;</span>' +
                            '</button>' +
                            '</div>')

                        $("input[name='veri']").addClass("border border-danger")

                        $("form").addClass("shake")

                        setTimeout(() => {
                            $("form").removeClass("shake")
                        }, 300)
                    }
                }

                const logout = () => {
                    data.isLogin = false
                    localStorage.setItem("isLogin", "false")
                }

                const getBusData = () => {
                    $.getJSON("./api/get.php", { mode: "getBusData" }, (r) => {
                        data.busData = r
                    })
                }

                const delBusRecord = (id) => {
                    data.busData.find((item) => item.id == id).chDel = true
                }

                const unBusDel = (id) => {
                    data.busData.find((item) => item.id == id).chDel = false
                }

                const confBusDel = (id) => {
                    $.post("./api/post.php", { mode: "delBus", id }, () => {
                        data.busData.find((item) => item.id == id).confdelAnimation = true
                        setTimeout(() => {
                            getBusData()
                        }, 200)
                    })
                }

                const editBusRecord = (item) => {
                    data.isEditBus = true
                    data.editBusId = item.id
                    data.editBusName = item.name
                    data.editBusTime = item.time
                }

                const editBusSubmit = (id) => {
                    if ($("#editBusForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "editBusData", id: data.editBusId, time: data.editBusTime }, () => {
                            data.isEditBus = false
                            $("#editBusForm>form").removeClass("was-validated")
                            getBusData()
                        })
                    } else {
                        $("#editBusForm>form").addClass("was-validated")
                    }
                }

                const editBusPrev = (id) => {
                    data.isEditBus = false
                    $("#editBusForm>form").removeClass("was-validated")
                }

                const addNewBus = () => {
                    data.isAddNewBus = true
                }

                const addNewBusSubmit = () => {
                    if ($("#addNewBusForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "addNewBus", name: data.addNewBus.name, time: data.addNewBus.time }, () => {
                            data.isAddNewBus = false
                            $("#addNewBusForm>form").removeClass("was-validated")
                            data.addNewBus = []
                            getBusData()
                        })
                    } else {
                        $("#addNewBusForm>form").addClass("was-validated")
                    }
                }

                const addNewBusPrev = () => {
                    data.isAddNewBus = false
                    $("#addNewBusForm>form").removeClass("was-validated")
                }

                const chgStation = () => {
                    data.flodDone = true
                    if (data.canFlod) {
                        data.canFlod = false
                        $("#busManage").animate({ scrollTop: 0 }, 350)
                        $("#stationManage").scrollTop(0)
                        data.isStationManage = true
                        setTimeout(() => {
                            data.canFlod = true
                        }, 800)
                    }
                }

                const chgBus = () => {
                    if (data.canFlod) {
                        data.canFlod = false
                        data.isStationManage = false
                        setTimeout(() => {
                            data.canFlod = true
                        }, 800)
                    }
                }

                const getStationData = () => {
                    $.getJSON("./api/get.php", { mode: "getStationData" }, (r) => {
                        data.stationData = r
                    })
                }

                const addNewStation = () => {
                    data.isAddNewStation = true
                }

                const addNewStationSubmit = () => {
                    if ($("#addNewStationForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "addNewStation", name: data.addNewStation.name, time: data.addNewStation.time, wait: data.addNewStation.wait }, () => {
                            data.isAddNewStation = false
                            $("#addNewStationForm>form").removeClass("was-validated")
                            data.addNewStation = []
                            getStationData()
                        })
                    } else {
                        $("#addNewStationForm>form").addClass("was-validated")
                    }
                }

                const addNewStationPrev = () => {
                    data.isAddNewStation = false
                    $("#addNewStationForm>form").removeClass("was-validated")
                }

                const editStationRecord = (item) => {
                    data.isEditStation = true
                    data.editStationId = item.id
                    data.editStationName = item.name
                    data.editStationTime = item.time
                    data.editStationWait = item.wait
                }

                const delStationRecord = (id) => {
                    data.stationData.find((item) => item.id == id).chDel = true
                }

                const confStationDel = (id) => {
                    $.post("./api/post.php", { mode: "delStation", id }, () => {
                        data.stationData.find((item) => item.id == id).confdelAnimation = true
                        setTimeout(() => {
                            getStationData()
                        }, 200)
                    })
                }

                const unStationDel = (id) => {
                    data.stationData.find((item) => item.id == id).chDel = false
                }

                const editStationSubmit = () => {
                    if ($("#editStationForm>form")[0].reportValidity()) {
                        $.post("./api/post.php", { mode: "editStationData", id: data.editStationId, time: data.editStationTime, wait: data.editStationWait }, () => {
                            data.isEditStation = false
                            $("#editStationForm>form").removeClass("was-validated")
                            getStationData()
                        })
                    } else {
                        $("#editBusForm>form").addClass("was-validated")
                    }
                }

                const editStationPrev = () => {
                    data.isEditStation = false
                    $("#editStationForm>form").removeClass("was-validated")
                }

                onMounted(() => {
                    data.isLogin = localStorage.getItem("isLogin") == "true"
                    reGenerate()
                    getBusData()
                    getStationData()
                })

                return {
                    data,
                    reGenerate,
                    login,
                    logout,
                    addNewBus,
                    getBusData,
                    delBusRecord,
                    unBusDel,
                    confBusDel,
                    editBusRecord,
                    editBusSubmit,
                    editBusPrev,
                    addNewBusSubmit,
                    addNewBusPrev,
                    chgStation,
                    chgBus,
                    getStationData,
                    addNewStation,
                    addNewStationSubmit,
                    addNewStationPrev,
                    editStationRecord,
                    delStationRecord,
                    confStationDel,
                    unStationDel,
                    editStationSubmit,
                    editStationPrev
                }

            }

        }).mount("#app")

    </script>

</body>

</html> -->